<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED RGB Strip Parallel - Coordinate Generator</title>
    <link rel="stylesheet" href="css/foundation.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #5c87ff;
            min-height: 100vh;
            padding: 20px;
        }

        .grid-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 1200px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .controls-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .controls-section label {
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        .main-content {
            margin-bottom: 30px;
        }

        .preview {
            background: #f8f9fa !important;
            border: none !important;
        }

        .preview h2 {
            color: #333;
            font-size: 20px;
            margin: 0;
        }

        .led-grid-container {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            display: inline-block;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
            overflow: auto;
            max-width: 100%;
            max-height: 500px;
        }

        .led-grid {
            display: grid;
            gap: 4px;
        }

        .led {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #555;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #444;
            position: relative;
        }

        .led:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .led.selected {
            box-shadow: 0 0 15px currentColor;
            border-color: currentColor;
        }

        .led-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8px;
            color: white;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 0 0 3px black;
        }

        .color-palette {
            background: #f8f9fa !important;
            border: none !important;
            margin-bottom: 20px;
        }

        .color-palette h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-item {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            cursor: grab;
            border: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .color-item:active {
            cursor: grabbing;
        }

        .color-item:hover {
            transform: scale(1.1);
            border-color: white;
            box-shadow: 0 0 15px currentColor;
        }

        .color-item.active {
            border-color: white;
            box-shadow: 0 0 20px currentColor;
        }

        .custom-color {
            margin-top: 10px;
            align-items: center;
        }

        .custom-color input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .custom-color input[type="text"] {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            margin: 0;
        }

        .selection-panel {
            background: #f8f9fa !important;
            border: none !important;
        }

        .selection-panel h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .button-group {
            margin-bottom: 15px;
        }

        .button-group .button {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .selected-list {
            max-height: 250px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .selected-item {
            padding: 8px;
            background: #e0e7ff;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .selected-item-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-preview {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #333;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .info-box {
            background: #e0e7ff !important;
            border-left: 4px solid #667eea !important;
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
            color: #4338ca;
            margin-bottom: 15px;
        }

        .wiring-diagram {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            overflow-x: auto;
        }

        .wiring-diagram h4 {
            font-size: 12px;
            margin-bottom: 10px;
            color: #333;
        }

        .wire-example {
            font-family: monospace;
            font-size: 10px;
            line-height: 1.4;
            color: #555;
            white-space: pre;
            overflow-x: auto;
        }

        .wire-line {
            margin: 1px 0;
        }

        .wire-data { 
            color: #ef4444; 
            font-weight: bold; 
        }

        .wire-gnd { 
            color: #000; 
            font-weight: bold; 
        }

        .wire-vcc { 
            color: #dc2626; 
            font-weight: bold; 
        }

        .wire-arrow { 
            color: #667eea; 
            font-weight: bold; 
            font-size: 10px; 
        }

        .code-section {
            margin-bottom: 25px;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }

        .code-header {
            background: #667eea;
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .copy-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
        }

        pre {
            margin: 0;
            padding: 15px;
            background: #1e1e1e;
            color: #d4d4d4;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }

        /* Responsive adjustments */
        @media screen and (max-width: 640px) {
            .grid-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .palette-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .led-grid-container {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="grid-container">
        <div class="grid-x grid-padding-x">
            <div class="cell">
                <h1>üé® LED RGB Strip Parallel - Coordinate Generator</h1>
                <p class="subtitle">Drag & Drop warna ke LED atau klik LED lalu pilih warna</p>
            </div>
        </div>

        <!-- Controls -->
        <div class="grid-x grid-padding-x controls-section">
            <div class="cell small-12 medium-6 large-3">
                <label for="rows">Jumlah Strip Horizontal:
                    <input type="number" id="rows" value="3" min="1" max="20">
                </label>
            </div>
            <div class="cell small-12 medium-6 large-3">
                <label for="cols">Jumlah Strip Vertikal:
                    <input type="number" id="cols" value="3" min="1" max="20">
                </label>
            </div>
            <div class="cell small-12 medium-6 large-3">
                <label for="ledsPerStrip">LED per Strip:
                    <input type="number" id="ledsPerStrip" value="10" min="1" max="100">
                </label>
            </div>
            <div class="cell small-12 medium-6 large-3">
                <label for="startCorner">Titik Awal:
                    <select id="startCorner">
                        <option value="bottom-left">Kiri Bawah</option>
                        <option value="bottom-right">Kanan Bawah</option>
                        <option value="top-left">Kiri Atas</option>
                        <option value="top-right">Kanan Atas</option>
                    </select>
                </label>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid-x grid-padding-x main-content">
            <!-- Preview -->
            <div class="cell small-12 large-8">
                <div class="preview callout">
                    <div class="grid-x align-justify">
                        <div class="cell auto">
                            <h2>üì≤ LED Matrix</h2>
                        </div>
                        <div class="cell shrink">
                            <label>
                                <input type="checkbox" id="zigzag" checked>
                                Mode Zigzag
                            </label>
                        </div>
                    </div>
                    <div id="zigzagInfo"></div>
                    <div class="led-grid-container">
                        <div id="ledGrid" class="led-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="cell small-12 large-4">
                <!-- Color Palette -->
                <div class="callout color-palette">
                    <h3>üé® Palet Warna</h3>
                    <div class="palette-grid" id="colorPalette"></div>
                    <div class="grid-x grid-padding-x custom-color">
                        <div class="cell shrink">
                            <input type="color" id="customColor" value="#ff0080">
                        </div>
                        <div class="cell auto">
                            <input type="text" id="hexInput" value="#ff0080" placeholder="#RRGGBB">
                        </div>
                    </div>
                </div>

                <!-- Selection Panel -->
                <div class="callout selection-panel">
                    <h3>‚ú® LED Terpilih</h3>
                    <div class="button-group">
                        <button class="button primary" onclick="selectAll()">Pilih Semua</button>
                        <button class="button alert" onclick="clearSelection()">Hapus Semua</button>
                    </div>
                    <div class="callout info-box">
                        <strong>Total Terpilih:</strong> <span id="selectedCount">0</span> LED<br>
                        <strong>Total LED:</strong> <span id="totalLeds">0</span>
                    </div>
                    <div class="selected-list" id="selectedList"></div>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="grid-x grid-padding-x">
            <div class="cell">
                <h4>üìã Kode Output untuk Arduino IDE</h4>
                <div id="codeOutput"></div>
            </div>
        </div>
    </div>

    <script>
        if (performance.navigation.type !== 1) {
            location.reload(true);
        }
        const state = {
            rows: 3,
            cols: 3,
            ledsPerStrip: 10,
            startCorner: 'bottom-left',
            zigzag: true,
            selectedLeds: {},
            coordinates: [],
            currentColor: '#ff0080'
        };

        const colorPalette = [
            { name: 'Merah', color: '#FF0000' },
            { name: 'Orange', color: '#FF8800' },
            { name: 'Kuning', color: '#FFFF00' },
            { name: 'Hijau', color: '#00FF00' },
            { name: 'Cyan', color: '#00FFFF' },
            { name: 'Biru', color: '#0000FF' },
            { name: 'Ungu', color: '#8800FF' },
            { name: 'Pink', color: '#FF0080' },
            { name: 'Putih', color: '#FFFFFF' },
            { name: 'Magenta', color: '#FF00FF' },
            { name: 'Lime', color: '#88FF00' },
            { name: 'Aqua', color: '#00FF88' }
        ];

        function initColorPalette() {
            const palette = document.getElementById('colorPalette');
            palette.innerHTML = colorPalette.map((c, i) => 
                `<div class="color-item" 
                      style="background: ${c.color}" 
                      data-color="${c.color}"
                      draggable="true"
                      title="${c.name}"
                      onclick="selectColor('${c.color}')"
                      ondragstart="dragStart(event, '${c.color}')"></div>`
            ).join('');
        }

        function selectColor(color) {
            state.currentColor = color;
            document.getElementById('customColor').value = color;
            document.getElementById('hexInput').value = color;
            
            document.querySelectorAll('.color-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.color === color) {
                    item.classList.add('active');
                }
            });
        }

        function dragStart(e, color) {
            e.dataTransfer.setData('color', color);
        }

        function updateState() {
            state.rows = parseInt(document.getElementById('rows').value);
            state.cols = parseInt(document.getElementById('cols').value);
            state.ledsPerStrip = parseInt(document.getElementById('ledsPerStrip').value);
            state.startCorner = document.getElementById('startCorner').value;
            state.zigzag = document.getElementById('zigzag').checked;
            
            state.selectedLeds = {};
            generateCoordinates();
            generatePreview();
            updateSelectedList();
            generateCode();
            updateZigzagInfo();
        }

        function updateZigzagInfo() {
            const info = document.getElementById('zigzagInfo');
            
            if (state.zigzag) {
                info.innerHTML = `
                    <div class="wiring-diagram">
                        <h4>üîå Sambungan Zigzag:</h4>
                        <div class="wire-example">
<span class="wire-line">Strip 1      Strip 2</span>
<span class="wire-line"><span class="wire-data">DI</span>‚Üí‚Üí‚Üí<span class="wire-data">DO</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-data">DI</span>‚Üí‚Üí‚Üí<span class="wire-data">DO</span></span>
<span class="wire-line"><span class="wire-gnd">GND</span>‚îÄ‚îÄ‚îÄ<span class="wire-gnd">GND</span>\\/<span class="wire-gnd">GND</span>‚îÄ‚îÄ‚îÄ<span class="wire-gnd">GND</span></span>
<span class="wire-line"><span class="wire-vcc">5V</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-vcc">5V</span>/\\<span class="wire-vcc">5V</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-vcc">5V</span></span>
<span class="wire-line">LED 0-${state.ledsPerStrip-1}  LED ${state.ledsPerStrip+state.ledsPerStrip-1}-${state.ledsPerStrip}</span>
<span class="wire-line">(Kanan)    (Kiri)</span>

<span class="wire-arrow">‚úÖ Kabel pendek</span>
<span class="wire-arrow">‚úÖ Hemat kabel</span>
<span class="wire-arrow">‚úÖ Arah bolak-balik</span>
                        </div>
                    </div>
                `;
            } else {
                info.innerHTML = `
                    <div class="wiring-diagram">
                        <h4>üîå Sambungan Normal:</h4>
                        <div class="wire-example">
<span class="wire-line">Strip 1      Strip 2</span>
<span class="wire-line"><span class="wire-data">DI</span>‚Üí‚Üí‚Üí<span class="wire-data">DO</span>    <span class="wire-data">DI</span>‚Üí‚Üí‚Üí<span class="wire-data">DO</span></span>
<span class="wire-line"><span class="wire-gnd">GND</span>‚îÄ‚îÄ‚îÄ<span class="wire-gnd">GND</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-gnd">GND</span>‚îÄ‚îÄ‚îÄ<span class="wire-gnd">GND</span></span>
<span class="wire-line"><span class="wire-vcc">5V</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-vcc">5V</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-vcc">5V</span>‚îÄ‚îÄ‚îÄ‚îÄ<span class="wire-vcc">5V</span></span>
<span class="wire-line">LED 0-${state.ledsPerStrip-1}  LED ${state.ledsPerStrip}-${state.ledsPerStrip+state.ledsPerStrip-1}</span>
<span class="wire-line">(Kanan)    (Kanan)</span>

<span class="wire-arrow">‚ö†Ô∏è Kabel panjang</span>
<span class="wire-arrow">‚úÖ Arah sama</span>
<span class="wire-arrow">‚úÖ Mudah debug</span>
                        </div>
                    </div>
                `;
            }
        }

        function generateCoordinates() {
            state.coordinates = [];
            let index = 0;
            
            for (let row = 0; row < state.rows; row++) {
                for (let col = 0; col < state.cols; col++) {
                    for (let led = 0; led < state.ledsPerStrip; led++) {
                        let x, y;
                        
                        // PERBAIKAN: Zigzag berlaku untuk baris (row), bukan kolom
                        const isReverse = state.zigzag && row % 2 === 1;
                        const effectiveLed = isReverse ? state.ledsPerStrip - 1 - led : led;
                        
                        if (state.startCorner === 'bottom-left') {
                            x = col * state.ledsPerStrip + effectiveLed;
                            y = state.rows - 1 - row;
                        } else if (state.startCorner === 'bottom-right') {
                            x = (state.cols - 1 - col) * state.ledsPerStrip + (state.ledsPerStrip - 1 - effectiveLed);
                            y = state.rows - 1 - row;
                        } else if (state.startCorner === 'top-left') {
                            x = col * state.ledsPerStrip + effectiveLed;
                            y = row;
                        } else { // top-right
                            x = (state.cols - 1 - col) * state.ledsPerStrip + (state.ledsPerStrip - 1 - effectiveLed);
                            y = row;
                        }
                        
                        state.coordinates.push({ index, x, y });
                        index++;
                    }
                }
            }
        }

        function generatePreview() {
            const grid = document.getElementById('ledGrid');
            const totalCols = state.cols * state.ledsPerStrip;  // horizontal
            const totalRows = state.rows;  // vertical
            
            grid.style.gridTemplateColumns = `repeat(${totalCols}, 25px)`;
            grid.style.gridTemplateRows = `repeat(${totalRows}, 25px)`;
            grid.innerHTML = '';
            
            const ledsByPosition = {};
            state.coordinates.forEach(coord => {
                const key = `${coord.x},${coord.y}`;
                ledsByPosition[key] = coord.index;
            });
            
            for (let row = 0; row < totalRows; row++) {
                for (let col = 0; col < totalCols; col++) {
                    const key = `${col},${row}`;
                    const ledIndex = ledsByPosition[key];
                    
                    if (ledIndex !== undefined) {
                        const led = document.createElement('div');
                        led.className = 'led';
                        led.dataset.index = ledIndex;
                        
                        const color = state.selectedLeds[ledIndex];
                        if (color) {
                            led.style.background = color;
                            led.classList.add('selected');
                        }
                        
                        led.ondragover = (e) => e.preventDefault();
                        led.ondrop = (e) => {
                            e.preventDefault();
                            const color = e.dataTransfer.getData('color');
                            setLedColor(ledIndex, color);
                        };
                        led.onclick = () => setLedColor(ledIndex, state.currentColor);
                        
                        const numLabel = document.createElement('div');
                        numLabel.className = 'led-number';
                        numLabel.textContent = ledIndex;
                        led.appendChild(numLabel);
                        
                        grid.appendChild(led);
                    }
                }
            }
            
            updateInfo();
        }

        function setLedColor(index, color) {
            if (state.selectedLeds[index] === color) {
                delete state.selectedLeds[index];
            } else {
                state.selectedLeds[index] = color;
            }
            
            const led = document.querySelector(`[data-index="${index}"]`);
            if (state.selectedLeds[index]) {
                led.style.background = color;
                led.classList.add('selected');
            } else {
                led.style.background = '#555';
                led.classList.remove('selected');
            }
            
            updateSelectedList();
            generateCode();
        }

        function selectAll() {
            state.coordinates.forEach(coord => {
                state.selectedLeds[coord.index] = state.currentColor;
            });
            generatePreview();
            updateSelectedList();
            generateCode();
        }

        function clearSelection() {
            state.selectedLeds = {};
            generatePreview();
            updateSelectedList();
            generateCode();
        }

        function updateSelectedList() {
            const list = document.getElementById('selectedList');
            const selected = Object.entries(state.selectedLeds).sort((a, b) => a[0] - b[0]);
            
            if (selected.length === 0) {
                list.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">Belum ada LED terpilih</div>';
            } else {
                list.innerHTML = selected.map(([index, color]) => {
                    const coord = state.coordinates[index];
                    return `
                        <div class="selected-item">
                            <div class="selected-item-info">
                                <div class="color-preview" style="background: ${color}"></div>
                                <span>LED ${index} (${coord.x}, ${coord.y})</span>
                            </div>
                            <button class="remove-btn" onclick="setLedColor(${index}, '${color}')">√ó</button>
                        </div>
                    `;
                }).join('');
            }
        }

        function updateInfo() {
            document.getElementById('totalLeds').textContent = state.coordinates.length;
            document.getElementById('selectedCount').textContent = Object.keys(state.selectedLeds).length;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

function generateCode() {
    const output = document.getElementById('codeOutput');
    const selected = Object.entries(state.selectedLeds);
    const totalLeds = state.coordinates.length;
    
    if (selected.length === 0) {
        output.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">Pilih LED dan warna terlebih dahulu untuk generate kode</div>';
        return;
    }

    const ledData = selected.map(([idx, color]) => {
        const rgb = hexToRgb(color);
        return `  {${idx}, ${rgb.r}, ${rgb.g}, ${rgb.b}}`;
    }).join(',\n');
    
    const arduinoCode = `#include "FastLED.h"

#define LED_PIN     6
#define NUM_LEDS    ${totalLeds}
#define BRIGHTNESS  50

CRGB leds[NUM_LEDS];

struct LEDColor {
  uint16_t index;
  uint8_t r, g, b;
};

const LEDColor ledColors[] = {
${ledData}
};

const uint8_t numColors = ${selected.length};

void setup() {
  FastLED.addLeds<WS2812B, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(BRIGHTNESS);

  FastLED.clear();
  delay(500);
  FastLED.show();
  delay(500);
}

void loop() {
  FastLED.clear();
  for(uint8_t i = 0; i < numColors; i++) {
    leds[ledColors[i].index] = CRGB(ledColors[i].r, ledColors[i].g, ledColors[i].b);
  }
  FastLED.show();
  delay(50);
}`;

    const esp32Code = `#include "FastLED.h"

#define LED_PIN     5
#define NUM_LEDS    ${totalLeds}
#define BRIGHTNESS  50

CRGB leds[NUM_LEDS];

struct LEDColor {
  uint16_t index;
  uint8_t r, g, b;
};

const LEDColor ledColors[] = {
${ledData}
};

const uint8_t numColors = ${selected.length};

void setup() {
  FastLED.addLeds<WS2812B, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(BRIGHTNESS);

  FastLED.clear();
  delay(500);
  FastLED.show();
  delay(500);
}

void loop() {
  FastLED.clear();
  for(uint8_t i = 0; i < numColors; i++) {
    leds[ledColors[i].index] = CRGB(ledColors[i].r, ledColors[i].g, ledColors[i].b);
  }
  FastLED.show();
  delay(50);
}`;

    const esp8266Code = `#include "FastLED.h"

#define LED_PIN     D6
#define NUM_LEDS    ${totalLeds}
#define BRIGHTNESS  50

CRGB leds[NUM_LEDS];

struct LEDColor {
  uint16_t index;
  uint8_t r, g, b;
};

const LEDColor ledColors[] = {
${ledData}
};

const uint8_t numColors = ${selected.length};

void setup() {
  FastLED.addLeds<WS2812B, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(BRIGHTNESS);

  FastLED.clear();
  delay(500);
  FastLED.show();
  delay(500);
}

void loop() {
  FastLED.clear();
  for(uint8_t i = 0; i < numColors; i++) {
    leds[ledColors[i].index] = CRGB(ledColors[i].r, ledColors[i].g, ledColors[i].b);
  }
  FastLED.show();
  delay(50);
}`;

    const stm32Code = `#include "FastLED.h"

#define LED_PIN     PA6
#define NUM_LEDS    ${totalLeds}
#define BRIGHTNESS  50

CRGB leds[NUM_LEDS];

struct LEDColor {
  uint16_t index;
  uint8_t r, g, b;
};

const LEDColor ledColors[] = {
${ledData}
};

const uint8_t numColors = ${selected.length};

void setup() {
  FastLED.addLeds<WS2812B, LED_PIN, GRB>(leds, NUM_LEDS);
  FastLED.setBrightness(BRIGHTNESS);

  FastLED.clear();
  delay(500);
  FastLED.show();
  delay(500);
}

void loop() {
  FastLED.clear();
  for(uint8_t i = 0; i < numColors; i++) {
    leds[ledColors[i].index] = CRGB(ledColors[i].r, ledColors[i].g, ledColors[i].b);
  }
  FastLED.show();
  delay(50);
}`;

    const codes = [
        { title: 'Arduino (Uno/Nano/Mega)', code: arduinoCode },
        { title: 'ESP32', code: esp32Code },
        { title: 'ESP8266', code: esp8266Code },
        { title: 'STM32', code: stm32Code }
    ];

    // Buat HTML structure dulu tanpa kode
    output.innerHTML = codes.map((item, idx) => `
        <div class="code-section">
            <div class="code-header">
                <span>${item.title}</span>
                <button class="copy-btn" onclick="copyCode(${idx})">üìã Copy</button>
            </div>
            <pre id="code-pre-${idx}"></pre>
        </div>
    `).join('');
    
    // Kemudian set kode menggunakan textContent (tidak akan di-escape)
    codes.forEach((item, idx) => {
        document.getElementById(`code-pre-${idx}`).textContent = item.code;
    });
}

        function copyCode(index) {
            const pre = document.querySelectorAll('pre')[index];
            const btn = document.querySelectorAll('.copy-btn')[index];
            
            navigator.clipboard.writeText(pre.textContent).then(() => {
                btn.textContent = '‚úì Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        document.getElementById('rows').addEventListener('input', updateState);
        document.getElementById('cols').addEventListener('input', updateState);
        document.getElementById('ledsPerStrip').addEventListener('input', updateState);
        document.getElementById('startCorner').addEventListener('change', updateState);
        document.getElementById('zigzag').addEventListener('change', updateState);

        document.getElementById('customColor').addEventListener('input', (e) => {
            state.currentColor = e.target.value;
            document.getElementById('hexInput').value = e.target.value;
        });

        document.getElementById('hexInput').addEventListener('input', (e) => {
            const hex = e.target.value;
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                state.currentColor = hex;
                document.getElementById('customColor').value = hex;
            }
        });

        initColorPalette();
        selectColor('#ff0080');
        updateState();
    </script>
</body>
</html>